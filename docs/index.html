<!DOCTYPE html>
<html dir="ltr" lang="en-US">

<head>
  <!-- Document Meta-->
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <!-- IE Compatibility Meta-->
  <meta name="author" content="zytheme" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="description" content="WHBAR" />
  <link href="assets/images/favicon/favicon.png" rel="icon" />
  <!--  Fonts-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500&amp;display=swap" rel="stylesheet"
    type="text/css" />
  <!-- Stylesheets-->
  <link href="assets/css/vendor.css" rel="stylesheet" />
  <link href="assets/css/style.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.css" rel="stylesheet" />
  <link rel="stylesheet" href="assets/css/custom.css">
  <link href="assets/css/emoji.css" rel="stylesheet">

  <!-- 
    Document Title
    ============================================= 
    -->
  <title>WHBAR</title>
</head>

<body class="body-scroll">
  <div class="bg-section">
    <img src="assets/images/background/bg-1.jpg" alt="background" />
  </div>
  <!--  
    Document Wrapper
    =============================================  
    -->
  <div class="wrapper clearfix" id="wrapper">

    <!--   
      Header
      =============================================  
      -->
    <header class="header header-transparent ">
      <nav class="navbar navbar-light navbar-expand-lg" id="primary-menu">
        <div class="container">
          <div class="col-lg-10 col-md-12 col-sm-12 col-centered">

            <div class="row">
              <div class="col-md-3">
                <a class="logo navbar-brand" href="index.html"><img class="logo logo-light"
                    src="assets/images/logo/logo-light.png" alt="WHBAR" />
                </a>
              </div>
              <div class="col-md-9">
                <div class="links_container">
                  <a class="link neumorphic-btn" href="javascript:getStatus();"><i class="fa fa-cog"></i>Status</a>
                  <a id="connectEthereum" data-tooltip="Only $5 one-time payment!" class="link neumorphic-btn" href="javascript:connectEthereum();"><i class="fa fa-unlock"></i>Ethereum Wallet</a>
                  <a id="connectHedera" data-tooltip="Only $5 one-time payment!" class="link neumorphic-btn" href="javascript:connectHedera();"><i class="fa fa-check-double"></i>Hedera Wallet</a>
                </div>
              </div>
            </div>

          </div>
          <!-- End .nav-collapse-->
        </div>
        <!-- End .container-->
      </nav>
      <!-- End .navbar-->
    </header>
    <!-- End Header-->
    <!-- Start hero #1-->
    <section class="hero" id="hero">
      <div class="container">
        <div class="hero-cotainer text--center">
          <div class="col-md-10 col-centered">
            <div id="hero-content-choice" class="hero-content choice" style="min-height: 320px; box-shadow:none">
              <div class="hero-action text-center">
                <h1>
                 <i class="em em-candy" aria-role="presentation" aria-label="CANDY"></i>
                </h1>
                <h2 style='font-family: "Nunito Sans", Arial, Helvetica, sans-serif;'>
                  Welcome to the Wrapping Portal
                </h2>
                <p style='font-family: "Nunito Sans", Arial, Helvetica, sans-serif;'>
                  Use this website with caution. Make sure to have an Ethereum and a Hedera account set up on your browser.
                </p>
                <p>
                  Cross-chain events can take up to 8 hrs to validate. Read the <a href="https://docs.xbar.network/wrapped-hbar/how-to-use-whbar" target="_blank">how to guide</a> if you have any questions.
                </p>
                <p>
                  Fees & Minimums (defined by the Validators<i class="em em-closed_lock_with_key" aria-role="presentation" aria-label="CLOSED LOCK WITH KEY"></i>):
                  <table style="margin-left: auto; margin-right: auto;">
                  <thead>
                    <tr>
                      <th></th>
                      <th>Wrapping</th>
                      <th>Unwrapping</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Minimum (hbar) total (incl. fee)</td>
                      <td id="wMin">_</td>
                      <td id="uMin">_</td>
                    </tr>
                    <tr>
                      <td>Percent (hbar) from the total (not incl. fee)</td>
                      <td id="wPer">_</td>
                      <td id="uPer">_</td>
                    </tr>
                    <tr>
                      <td>Fee (hbar)</td>
                      <td id="wFee">_</td>
                      <td id="uFee">_</td>
                    </tr>
                  </tbody>
                  </table>
                </p>
                <div class="hero-action1" style="padding: 40px 20px 30px 20px">
                  <div class="row">
                    <div class="col-md-3">
                      <div class="height shadow-inset">
                        <div class="centeralign">
                          <strong>Balance</strong> 
                          <h6 class="hbar"><div id="hbarBalance">_</div> HBAR</h6>
                          <p class="hpara">on Hedera Hashgraph
                          </p>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-6 col-centered">
                      <div class="calculate-center">
                        <div class="tabs boxed">
                          <button class="hbar-btn active">WRAP</button>
                          <button class="eth-btn">UNWRAP</button>
                        </div>
                        <div class="input-group1">
                          <input id="valueToTransfer" class="form-control" type="text" placeholder="0">
                          <!-- <span class="status inputtext">HBAR</span> -->
                          <div class="input-group-prepend status inputtext"><span class="input-group-text"><span
                                id="content-switcher" class="fa-envelope hbar-content"></span></span></div>
                        </div>
                        <div class="button-wrap content-centered">
                          <button class="neumorphic-btn operation options" onclick="doStuff();"><span>Wrap</span></button>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-3">
                      <div class="height shadow-inset">
                        <div class="centeralign">
                          <strong>Balance</strong> 
                          <h6 class="hbar"><div id="ethBalance">_</div> wHBAR</h6>
                          <p class="hpara">on Ethereum Network
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- End .row-->
        </div>
        <!-- End .hero-content-->
      </div>
      <!-- End .container-->
    </section>
    <!-- End #hero-->
    <!-- Start hero #1-->
    <div class="stats" style="">
      <div class="center">
        <div class="authorities shadow-inset">
          <h3>Previous Wrappings</h3>
          <p>Sent from this web browser</p>
          <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Type</th>
              <th>To</th>
              <th>Amount</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="wrapping">
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
          </tbody>
          </table>
        </div>
        <div class="authorities shadow-inset">
          <h3>Previous unWrappings</h3>
          <p>Sent from this web browser</p>
          <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Type</th>
              <th>To</th>
              <th>Amount</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="unwrapping">
            <tr>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
          </tbody>
          </table>
        </div>
      </div>
    </div>
    <div class="stats" style="display:none;">
      <div class="center">
        <div class="lists">
          <h3>Configuration</h3>
          <div class="items">
            <div>
              <div class="counter">
                <div class="outer-circle">
                  <div class="inside-circle">
                    249
                  </div>
                </div>
              </div>
              <strong>
                Number of Nodes
              </strong>
              <small>Secure Environments</small>
            </div>
            <div>
              <div class="counter">
                <div class="outer-circle">
                  <div class="inside-circle">

                    249
                  </div>
                </div>
              </div>
              <strong>
                Administrators
              </strong>
              <small>Multi-sig Wallet Holders</small>
            </div>
            <div>
              <div class="counter">
                <div class="outer-circle">
                  <div class="inside-circle">
                    249
                  </div>
                </div>
              </div>
              <strong>
                <span>Min</span> HBAR
              </strong>
              <small>Required for wrapping</small>
            </div>
            <div>
              <div class="counter">
                <div class="outer-circle">
                  <div class="inside-circle">
                    249
                  </div>
                </div>
              </div>
              <strong>
                <span>Min</span> wHBAR</strong>
              <small>Required for unwrapping</small>
            </div>
          </div>
        </div>
        <div class="authorities">
          <h3>Authorities</h3>

          <ul>
            <li>
              <strong>
                1
              </strong>
              <div>

                <div class="des">
                  0x5D44BC8642947685F45004c936245B969F9709a6
                </div>
              </div>
            </li>
            <li>
              <strong>
                2
              </strong>
              <div>

                <div class="des">
                  0x5D44BC8642947685F45004c936245B969F9709a6
                </div>
              </div>
            </li>
            <li>
              <strong>
                3
              </strong>
              <div>

                <div class="des">
                  0x5D44BC8642947685F45004c936245B969F9709a6
                </div>
              </div>
            </li>
          </ul>

        </div>
      </div>
    </div>
    <!-- End #hero-->
    <!-- 
      Footer #1
      ============================================= 
      -->
    <footer class="footer" id="footer">
      <!-- 
        Copyrights
        =============================================  
        -->
      <div class="container">
        <div class="row">
          <div class="col-10 col-md-10 col-lg-10 text--center col-centered">
            <div class="footer-copyright"><span> © 2020 WHBAR. Powered by the <a href="https://xbar.network" target="_blank">xBar Network</a></span>
              <div class="footer-social">
                <ul class="d-flex list-unstyled mb-5 mb-lg-0">
                  <li><a href="https://docs.xbar.network" target="_blank" class="socialbtn socialbtn-icon-only btn-pill btn-primary"><span
                        class="fa fa-book"></span></a></li>
                  <li><a href="https://discord.gg/38xcZ3A" target="_blank" class="socialbtn socialbtn-icon-only btn-pill btn-primary"><span
                        class="fab fa-discord"></span></a></li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- End .container  -->
    </footer>
  </div>
  <!-- Modal -->
  <div class="modal fade" id="receiptModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
      <div class="modal-content" style="background-color: #e6ecf3;">
        <div class="modal-header" style="border-bottom: none;margin-top: -50px;margin-right: -45px;">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
              aria-hidden="true">×</span></button>
        </div>
        <div class="modal-body">
          <h4>
            Welcome<i class="em em-wave" aria-role="presentation" aria-label="WAVING HAND SIGN"></i> to the Wrapping Station<i class="em em-candy" aria-role="presentation" aria-label="CANDY"></i>  
          </h4>
            <p>
            We use minimal analytics for bug tracking<i class="em em-bug" aria-role="presentation" aria-label="BUG"></i>
            </p>
            <p>
            You'll need to run on a Chromium-based browser with both MetaMask and Composer Extensions. <i class="em em-mega" aria-role="presentation" aria-label="CHEERING MEGAPHONE"></i><small>Need us to add other wallets? Let us know!</small>
            </p>
            <p>
            Wrong clicks can lose money<i class="em em-money_with_wings" aria-role="presentation" aria-label="MONEY WITH WINGS"></i>. We are only providing a web portal to a smart contract.
            </p>
            <p>
            Please read through the guide on our <a href="https://docs.xbar.network/wrapped-hbar/how-to-use-whbar">docs</a>
            </p>
            <p>
              Click anywhere to dismiss this popup
            </p>
        </div>
      </div>
    </div>
  </div>
  </div>
  <!-- End #wrapper   -->
  <!-- 
    Footer Scripts
    =============================================  
    -->
  <script src="assets/js/vendor/jquery-3.5.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
  <script src="https://cdn.hashingsystems.com/hash.js"></script>
  <script src="https://unpkg.com/popper.js"></script>
  <script src="https://unpkg.com/tooltip.js"></script>
  <script>

    document.addEventListener('DOMContentLoaded',function(){
      var trigger = document.getElementById("connectHedera");
      var instance = new Tooltip(trigger,{
        title: trigger.getAttribute('data-tooltip'),
        trigger: "hover",
      });
    });
    toastr.options.timeOut = 300000;
    toastr.options.extendedTimeOut = 60000;
    toastr.options.progressBar = true;

    var ethAddress="";
    var hederaAccount="";
    var notificationTexts = {
    info: Array('Sending Transaction.'),
    success: Array('Successfully authenticated MetaMask', 'Successfully authenticated Composer for Hedera Hashgraph', 'Wrapped Successfully. Enjoy!', 'unWrapepd Successfully. Enjoy!'),
    error: Array('Must connect via Google Chrome on Desktop!', 'Unable to connect to MetaMask, do you have it installed?', 'Unable to connect to Composer for Hedera Hashgraph, do you have it installed?', 'Not enough balance on Composer account!', 'Not enough balance on MetaMask account!') };
    function display(type, n){
      toastr[type](notificationTexts[type][n])
    }
    async function addWrap(txObj){
      var txs = JSON.parse(window.localStorage.getItem(txObj.type))
      if(txs==null){
              txs = new Array();
      }
      txs.push(txObj);
      await window.localStorage.setItem(txObj.type,JSON.stringify(txs));
      showTables();
    }
    function getTxs(type){
      return JSON.parse(window.localStorage.getItem(type));
    }
    function getStatus(){
      toastr['info']('This feature will be coming soon! Until then check our Etherscan url!');
    }
    var wrap, unwrap;
    function showTables(){
      wrap = getTxs("wrap");
      unwrap = getTxs("unwrap");
      // wrapping
      var wrapHtml = "";
      for(var w in wrap){
          wrapHtml += 
            `
            <tr>
              <td>`+wrap[w].date+`</td>
              <td>`+wrap[w].type+`</td>
              <td>`+wrap[w].to+`</td>
              <td>`+wrap[w].amount+`</td>
              <td>`+wrap[w].status+`</td>
            </tr>
            `;
      }
      document.getElementById("wrapping").innerHTML = wrapHtml;
      var unwrapHtml = "";
      for(var w in unwrap){
          unwrapHtml += 
            `
            <tr>
              <td>`+unwrap[w].date+`</td>
              <td>`+unwrap[w].type+`</td>
              <td>`+unwrap[w].to+`</td>
              <td>`+unwrap[w].amount+`</td>
              <td>`+unwrap[w].status+`</td>
            </tr>
            `;
      }
      document.getElementById("unwrapping").innerHTML = unwrapHtml;
    }
/*
    function checkByTxId(){
          var easternUnion = web3.eth.contract([{ "constant": true, "inputs": [ { "internalType": "string", "name": "txId", "type": "string" } ], "name": "checkTxById", "outputs": [ { "internalType": "bool", "name": "txExists", "type": "bool" } ], "payable": false, "stateMutability": "view", "type": "function" }]);
          var whbar = easternUnion.at(eth_contract);
          for(var c_ in wrap)
              whbar.checkTxById(wrap[c_], (error, data) => {
                if(!error){
                    wrap[]
                }
               //alert("attempted to burn "+amount+" token and give to "+hederaAccount+" hedera account.");
              });
    }
*/
    var debug = false;

    function connectEthereum(){
      if(!window.ethereum){
        toastr['error']("Could not connect to MetaMask extension!");
      }
      window.ethereum.enable().then(function(addr){
        //alert(addr);
        ethAddress = addr;
        toastr['success']('connected to: '+addr+' Ethereum address');
        doContract();
        getDeets();
        showTables();
        web3.version.getNetwork((err, network) => {
          currentNetwork_e = (debug) ? 1 : network;
        })
      })
    }

    var eth_contract = "0x2747398daab72e8c583f02318fa9924eba4bdefb";
    function updateById(id, text){
      document.getElementById(id).innerHTML=text;
    }
    var currentNetwork_h;
    var currentNetwork_e;
    function connectHedera(){
      if(!hash){
        toastr['error']("Composer not found!");
      }
      if(!hash.triggerCheckBalance){
        toastr['error']("Could not connect to Composer account!");
      }
      hash.triggerCheckBalance()
      .then(res => {
          console.log(res);
          currentNetwork_h = (debug) ? "mainnet" : res.currentNetwork;
          hederaAccount = res.currentAccount;
          toastr['success']('connected to: ' + res.currentAccount +' Hedera Hashgraph Account');
          updateById('hbarBalance', res.balance/100000000);
      }).catch(err => toastr['error']("Could not connect to Composer account!"));
    }
    function doContract(){
      var easternUnion = web3.eth.contract([ { "constant": true, "inputs": [ { "internalType": "address", "name": "account", "type": "address" } ], "name": "balanceOf", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "decimals", "outputs": [ { "internalType": "uint8", "name": "", "type": "uint8" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "getManagers", "outputs": [ { "internalType": "address", "name": "", "type": "address" }, { "internalType": "address", "name": "", "type": "address" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "getPause", "outputs": [ { "internalType": "bool", "name": "", "type": "bool" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "name", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "symbol", "outputs": [ { "internalType": "string", "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "totalSupply", "outputs": [ { "internalType": "uint256", "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" } ]);
      var whbar = easternUnion.at(eth_contract);
      whbar.balanceOf(ethAddress, (error, balance) => {
        whbar.decimals((error, decimals) => {
          var update_ =0;
          if(balance!=0){
            update_ = balance/(100000000);
          }
          //alert(balance+" "+decimals+" "+update_);
          updateById('ethBalance', update_);
        });
      });
    }
    if(!window.ethereum){
      toastr['error']("MetaMask not found!");
    }
    function doStuff(){
      // verify its a valid input!
      var amount = document.getElementById("valueToTransfer").value;
      if(document.querySelector('.operation').innerText == "UNWRAP" && amount<fees.unWrappingMinimum || document.querySelector('.operation').innerText == "WRAP" && amount<fees.WrappingMinimum ){
        toastr['error']("Amount should exceed minimum!");
        return;
      }
      amount = amount * 100000000;
      if(!hederaAccount){
        toastr['error']("Could not connect to Composer extension!");
      }
      if(!ethAddress){
        toastr['error']("Could not connect to MetaMask extension!");
      }
      if(currentNetwork_h == "testnet"){
        toastr['error']("Wrong Hedera Network selected. Please switch to MainNet");
      }
      if(currentNetwork_e != 1){
        toastr['error']("Wrong Ethereum Network selected. Please switch to Mainnet");
      }
      if(document.querySelector('.operation').innerText == "WRAP" && ethAddress != '' && currentNetwork_h != "testnet" && currentNetwork_e == 1){
        //  wrap
        //  Hedera Smart Contract Call
          const data  = {
              memo: ethAddress,
              contractid: "0.0.54356",
              abi:`[{"constant":false,"name":"deposit","payable":true,"stateMutability":"payable","type":"function","contractId":{"contract":54356,"realm":0,"shard":0},"contractName":"hbar_filter"}]`,
              params:`[]`,
              amount
          }
          return console.log(hash.triggerSmartContract(data).then((data) => {
            if(data.status == "success"){
              // now we're talking. let's store this.
              var     txObject        = {};
                      txObject.date   = new Date();
                      txObject.type   = "wrap";
                      txObject.to     = ethAddress;
                      txObject.amount = amount; // in tinybar
                      txObject.status = "deposit";
              addWrap(txObject);
            }
          }) );
      }else if( hederaAccount != ''  && currentNetwork_h != "testnet" && currentNetwork_e == 1){
        //  unwrap
        //  Ethereum Call
          var easternUnion = web3.eth.contract([{ "constant": false, "inputs": [ { "internalType": "uint256", "name": "amount", "type": "uint256" }, { "internalType": "address", "name": "accountId", "type": "address" } ], "name": "burn", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }]);
          var whbar = easternUnion.at(eth_contract);
          var beneficiary = "0x"+hash.accountIdToEthAddress(hederaAccount);
          whbar.burn(amount, beneficiary, (error, data) => {
            if(!error){
                var txObject = {};
                      txObject.date   = new Date();
                      txObject.type   = "unwrap";
                      txObject.to     = hederaAccount;
                      txObject.amount = amount; // in tinybar
                      txObject.status = "burned";
                addWrap(txObject);
            }
           //alert("attempted to burn "+amount+" token and give to "+hederaAccount+" hedera account.");
          });
      }
    }
    setTimeout(function(){
    $("#receiptModal").modal()
  }, 200);
    var fees = new Object();
    function getDeets(){
      var easternUnion = web3.eth.contract([{ "constant": true, "inputs": [], "name": "getFees", "outputs": [ { "internalType": "uint256", "name": "wrappedMin", "type": "uint256" }, { "internalType": "uint256", "name": "wrappedPercent", "type": "uint256" }, { "internalType": "uint256", "name": "wrappedFee", "type": "uint256" }, { "internalType": "uint256", "name": "unwrapMin", "type": "uint256" }, { "internalType": "uint256", "name": "unwrapPercent", "type": "uint256" }, { "internalType": "uint256", "name": "unwrapFee", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }]);
      var whbar = easternUnion.at(eth_contract);
          whbar.getFees(function(err, data) {
            if (!err){
              fees.unWrappingFee = data[5]["c"][0]/100000000;
              fees.unWrappingPercent = data[4]["c"][0]/100;
              fees.unWrappingMinimum = data[3]["c"][0]/100000000;
              fees.WrappingFee= data[2]["c"][0]/100000000;
              fees.WrappingPercent = data[1]["c"][0]/100;
              fees.WrappingMinimum = data[0]["c"][0]/100000000;
              console.log(fees);
              document.getElementById("uPer").innerText = fees.unWrappingPercent + "%";
              document.getElementById("uFee").innerText = fees.unWrappingFee;
              document.getElementById("uMin").innerText = fees.unWrappingMinimum;
              document.getElementById("wPer").innerText = fees.WrappingPercent + "%";
              document.getElementById("wMin").innerText = fees.WrappingMinimum;
              document.getElementById("wFee").innerText = fees.WrappingFee;
            }
          });
    }
    setTimeout(function(){
      connectEthereum();
      setTimeout(function(){
        connectHedera();
      }, 5000)
    }, 1000)
  </script>
  <script src="assets/js/vendor.js"></script>
  <script src="assets/js/functions.js"></script>
</body>
</html>
